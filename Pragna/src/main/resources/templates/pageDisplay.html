<html lang="en">
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="/sample.css" />
    <link rel="stylesheet" href="/manage-audio.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.3.3/dist/sweetalert2.all.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.3.3/dist/sweetalert2.min.css"> 
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <link href="/rateit.css" rel="stylesheet" type="text/css">
	<script src="/jquery.rateit.js"></script>
    <title>Text to Speech</title>
<style>
.rateit .rateit-selected {
color: rgb(239, 197, 41) !important;
}
.rateit.rateit-font .rateit-reset {
	display: none !important;
}
</style>
  </head>
  <body class="container mt-5 bg-dark">
	<div class="row">
	<div class="col-sm-6">
    <image width="100%" height="500px" id="image_id"></image>
	</div>
	<div class="col-sm-6">
	
    <!-- Text Area  for the User to Type -->
    <div class="form-control bg-dark text-light" style="height: 255px;" id="text_id"></div>

    <p class="label text-light mt-4">Select Voice</p>
    
    <!-- Select Menu for Voice -->
    <select id="voices" class="form-select bg-secondary text-light"></select>

    <!-- Range Slliders for Volume, Rate & Pitch -->
    <div class="d-flex mt-4 text-light">
      <div class="mx-3">
        <p class="label">Volume</p>
        <input type="range" min="0" max="1" value="1" step="0.1" id="volume" />
        <span id="volume-label" class="ms-2">1</span>
      </div>
      <div class="mx-3">
        <p class="label">Rate</p>
        <input type="range" min="0.1" max="10" value="1" id="rate" step="0.1" />
        <span id="rate-label" class="ms-2">1</span>
      </div>
     
	 <div class="mx-3"> 
        <p class="label">Pitch</p>
        <input type="range" min="0" max="2" value="1" step="0.1" id="pitch" />
        <span id="pitch-label" class="ms-2">1</span>
      </div>
    </div>
	
    <!-- Control Buttons -->
    <div class="mb-5">
	  <button id="previousId" onclick="previous()" class="btn btn-primary mt-4"><i class="fas fa-chevron-left"></i></button>
      <button id="start" class="btn btn-success hover-button mt-4" data-hover-text="Start"><i class="fas fa-play"></i></button>
      <button id="pause" class="btn btn-warning hover-button mt-4" style="display: none;" data-hover-text="Pause"><i class="fas fa-pause"></i></button>
      <button id="resume" class="btn btn-info hover-button mt-4" style="display: none;" data-hover-text="Resume"><i class="fas fa-play-circle"></i></button>
      <!-- <button id="cancel" class="btn btn-danger hover-button mt-4 me-3" style="display: none;" data-hover-text="Stop"><i class="fas fa-stop"></i></button> -->
	  <button id="recordButton" class="btn btn-danger hover-button mt-4 ms-3" data-hover-text="Start_Record"><i class="fas fa-microphone"></i></button>
	  <button id="pauseButton" class="btn btn-danger hover-button mt-4 ms-3" style="display: none;"data-hover-text="Pause_Record"><i class="fas fa-pause"></i></button>
	  <button id="stopButton" class="btn btn-danger hover-button mt-4 ms-3" style="display: none;" data-hover-text="Stop_Record"><i class="fas fa-stop"></i></button>
	  <button id="nextId" onclick="next()" class="btn btn-primary mt-4" style="float: right;"><i class="fas fa-chevron-right"></i></button>
    </div>
	</div>
	</div>
	
	<div class="playback">
			<ol id="recordingsList"></ol>
	</div>
	
	<div id="overlay">
  <div class="cv-spinner">
    <span class="spinner"></span>
  </div>
</div>	


<div id="myModal" class="modal">
  <div class="modal-content" style="margin: 2% auto;">

    <span class="close">&times;</span>
    
    <div class="container mt-4">
    <h1 style="margin-top:0px">Speech Analysis Report</h1>
    <div class="row">
      <div class="container mt-5">
  <div class="row">
    <div class="col-md-5">
      <h2>Fluency and Rhythm</h2>
      <canvas id="fluencyRhythmChart" width="400" height="200"></canvas>
    </div>
    <div class="col-md-7">
      <h2>Word Pronunciation Scores</h2>
      <canvas id="pronunciationChart" width="400" height="200"></canvas>
    </div>
    
  </div>
</div>
    </div>
    <div class="row mt-4">
	<div class="row">
	 <div class="col-md-2"></div>
      <div class="col-md-8">
        <h2>Word Pronunciation</h2>
        <div id="wordCharts"></div>
      </div>
	  <div class="col-md-2"></div>
	  </div>
    </div>
  </div>
    
  </div>
</div>																								
  </body>
  
<script src="/sample.js"></script>
<script src="/recorder.js"></script>
<script src="/app.js"></script>

<script>



var url = window.location.href;
var path = new URL(url).pathname;
var id=path.split("/")[2];
var previous_id="";
var next_id="";
document.addEventListener('DOMContentLoaded', function()  {
	
	var formData = new FormData();
	   formData.append("pageId", id);
	   
	   var xhr = new XMLHttpRequest();
	   xhr.open("POST", "/page/getPageById");
	   xhr.send(formData);
	   xhr.addEventListener("readystatechange", function () {
	   	  if (this.readyState === 4) {
	   		 console.log(this.responseText);
	   		var response = JSON.parse(this.responseText);
	   		var pageId = response.pageId;
	   		console.log(pageId);
	   		document.getElementById("text_id").innerHTML=response.text;
	   		document.getElementById("image_id").src=response.imageUrl;
	   	  }
	   	});
	   
	   var xhr1 = new XMLHttpRequest();
	   xhr1.open("POST", "/page/getPreviousNextIds");
	   xhr1.send(formData);
	   xhr1.addEventListener("readystatechange", function () {
	   	  if (this.readyState === 4) {
	   		 console.log(this.responseText);
	   		var response = JSON.parse(this.responseText);
	   		previous_id = response.previuos;
	   		next_id = response.next;
	   		
	   		if(response.previuos == null)
			{
	   			const button1 = document.getElementById('previousId');
	   			 button1.disabled = true;
			}
	   		if(response.next == null)
			{
	   			const button2 = document.getElementById('nextId');
	   			 button2.disabled = true;
			}
	   		}
	   	});
	   
	  

})

function previous()
{
	if(previous_id>0)
		{
	window.open("/page/"+previous_id, "_self");
		}
		else{
			Swal.fire({
	   			  icon: 'error',
	   			  title: 'Page Not Found..!',
	   			 })
		}
}
function next()
{
			if(next_id>0)
	   			{
	   			window.open("/page/"+next_id, "_self");
	   			}
	   		else{
	   			Swal.fire({
	   			  icon: 'error',
	   			  title: 'Page Not Found..!',
	   			 })
	   		}
}

/* $(document).ready(function() {
	  // Sample data (replace with your actual data)
	  var jsonData = {
	  "result": {
	    "pronunciation": 70,
	    "words": [
	      {
	        "word": "demo",
	       "phonics": [
	          {
	            "overall": 70,
	            "spell": "d",
	            "phoneme": [
	              "d"
	            ]
	          },
	          {
	            "overall": 58,
	            "spell": "e",
	            "phoneme": [
	              "ɛ"
	            ]
	          },
	          {
	            "overall": 80,
	            "spell": "m",
	            "phoneme": [
	              "m"
	            ]
	          },
	          {
	            "overall": 68,
	            "spell": "o",
	            "phoneme": [
	              "o"
	            ]
	          }
	        ],
	        "scores": {
	          "overall": 71,
	          "pronunciation": 71,
	          "prominence": 1
	        }
		  },
	      {
	        "word": "for",
	        "phonics": [
	          {
	            "overall": 95,
	            "spell": "f",
	            "phoneme": [
	              "f"
	            ]
	          },
	          {
	            "overall": 60,
	            "spell": "o",
	            "phoneme": [
	              "ɔ"
	            ]
	          },
	          {
	            "overall": 66,
	            "spell": "r",
	            "phoneme": [
	              "r"
	            ]
	          }
	        ],
	        "scores": {
	          "overall": 75,
	          "pronunciation": 75,
	          "prominence": 0
	        }
		  },
	      {
	        "word": "testing",
	         "phonics": [
	          {
	            "overall": 1,
	            "spell": "t",
	            "phoneme": [
	              "t"
	            ]
	          },
	          {
	            "overall": 0,
	            "spell": "e",
	            "phoneme": [
	              "ɛ"
	            ]
	          },
	          {
	            "overall": 17,
	            "spell": "s",
	            "phoneme": [
	              "s"
	            ]
	          },
	          {
	            "overall": 100,
	            "spell": "t",
	            "phoneme": [
	              "t"
	            ]
	          },
	          {
	            "overall": 100,
	            "spell": "i",
	            "phoneme": [
	              "ɪ"
	            ]
	          },
	          {
	            "overall": 92,
	            "spell": "ng",
	            "phoneme": [
	              "ŋ"
	            ]
	          }
	        ],
	        "scores": {
	          "overall": 63,
	          "pronunciation": 63,
	          "prominence": 1
	        }
	      }
	    ],
	    "fluency": 99,
	    "rhythm": 90,
	    "rear_tone": "fall",
	    "overall": 75,
	    "resource_version": "3.4.9",
	    "oov": "pargna",
	    "speed": 109,
	    "duration": "2.305",
	    "integrity": 100,
	    "pause_count": 0,
	    "kernel_version": "5.9.1"
	  }
	}; // Your JSON data

	 
	 var pronunciationChartCtx = document.getElementById('pronunciationChart').getContext('2d');
	  var fluencyRhythmChartCtx = document.getElementById('fluencyRhythmChart').getContext('2d');
	  
	  // Process jsonData and extract necessary data for charts
	  
	  // Example data for demonstration
	  var words = jsonData.result.words;
		var pronunciationScores = words.map(function(word) {
		return word.scores.pronunciation;
		});
	  var fluency = jsonData.result.fluency;
	var rhythm = jsonData.result.rhythm;
	var overall = jsonData.result.overall;
	
	var fluencyRhythmData = [overall, fluency, rhythm ];
	  
	  // Create charts
	  new Chart(pronunciationChartCtx, {
	    type: 'bar',
	   data: {
	      labels: jsonData.result.words.map(function(word) {
	        return word.word;
	      }),
	      datasets: [{
	        label: 'Pronunciation Score',
	        data: pronunciationScores,
	        backgroundColor: 'rgba(75, 192, 192, 0.2)',
	        borderColor: 'rgba(75, 192, 192, 1)',
	        borderWidth: 1
	      }]
	    },
	    options: {
	      scales: {
	        y: {
	          beginAtZero: true,
	          max: 100
	        }
	      }
	    }
	  });
	  
	  new Chart(fluencyRhythmChartCtx, {
	    type: 'polarArea',
	    data: {
	      labels: ['Overall', 'Fluency', 'Rhythm'],
	      datasets: [{
	        data: fluencyRhythmData,
	        backgroundColor: ['rgba(75, 192, 192, 0.5)', 'rgba(255, 99, 132, 0.5)', 'rgba(255, 100, 142, 0.5)']
	      }]
	    }
	  });
	  
	  var words = jsonData.result.words;

	  // Create Word Pronunciation Charts
	  var wordChartsDiv = document.getElementById("wordCharts");
	  jsonData.result.words.forEach(function(word) {
	    var wordChartCanvas = document.createElement("canvas");
	    wordChartCanvas.className = "my-4";
		wordChartCanvas.setAttribute("width", "546"); // Set canvas width
	    wordChartCanvas.setAttribute("height", "273"); // Set canvas height
	    wordChartsDiv.appendChild(wordChartCanvas);
	    
		var phonemeLabels = word.phonics.map(function(phoneme) {
	      return phoneme.spell;
	    });

	    var phonemeScores = word.phonics.map(function(phoneme) {
	      return phoneme.overall;
	    });
	    
		var wordChartCtx = wordChartCanvas.getContext("2d");
	    var wordChart = new Chart(wordChartCtx, {
	      type: 'bar',
	      data: {
	        labels: phonemeLabels,
	        datasets: [{
	          label: 'Phoneme Score',
	          data: phonemeScores,
	          backgroundColor: 'rgba(75, 192, 192, 0.2)',
	          borderColor: 'rgba(75, 192, 192, 1)',
	          borderWidth: 1
	        }]
	      },
	      options: {
	        scales: {
	          y: {
	            beginAtZero: true
	          }
	        }
	      }
	    });
	  });
}); */
</script>
</html>